import"vue-tsx-support/enable-check";import{component as e}from"vue-tsx-support";import t from"vue";import{Transforms as n,Text as r,Editor as o,Node as a,Path as i,Range as s,createEditor as d,Element as l}from"slate";import c from"direction";import{isKeyHotkey as u}from"is-hotkey";var f=new WeakMap,h=new WeakMap,p=new WeakMap,v=new WeakMap,g=new WeakMap,m=new WeakMap,w=new WeakMap,y=new WeakMap,b=new WeakMap,S=new WeakMap,k=Symbol("placeholder"),x=new Map,C=new Map,D=new Map,O=null,E=!1,F=0;function _(){if(!O)throw new Error("invalid hooks call: hooks can only be called in a function passed to withHooks.")}function B(e){return e._isVue?e.$el:e}function N(e,t){_();var n=++F;if(E){var r=function e(){var t=e.current;t&&(t(),e.current=null)},o=function e(){var t=e.current;t&&(r.current=t.call(this),e.current=null)};o.current=e,O._effectStore[n]={effect:o,cleanup:r,deps:t},O.$on("hook:mounted",o),O.$on("hook:destroyed",r),(!t||t.length>0)&&O.$on("hook:updated",o)}else{var a=O._effectStore[n],i=a.effect,s=a.cleanup,d=a.deps,l=void 0===d?[]:d;a.deps=t,t&&!t.some((function(e,t){return e!==l[t]}))||(s(),i.current=e)}}function $(e){_();var t=++F,n=O._refsStore;return O.$on("hook:mounted",(function(){this.$refs[t]&&(n[t].current=B(this.$refs[t]))})),O.$on("hook:updated",(function(){this.$refs[t]&&(n[t].current=B(this.$refs[t]))})),E?n[t]={current:e,id:t}:n[t]}function M(e){e.mixin({beforeCreate:function(){var e=this.$options,t=e.hooks,n=e.data;t&&(this._effectStore={},this._refsStore={},this._computedStore={},this.$options.data=function(){var e=n?n.call(this):{};return e._state={},e})},beforeMount:function(){var e=this.$options,t=e.hooks,n=e.render;t&&n&&(this.$options.render=function(e){F=0,O=this,E=!this._vnode;var r=t.call(this,this.$props);Object.assign(this._self,r);var o=n.call(this,e);return O=null,o})}})}function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||R(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||R(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function z(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=R(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}var K,U=0,J=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="".concat(U++)},q=function(e){return V(e)&&1===e.nodeType},V=function(e){return e instanceof Node},H=function(e){return V(e)&&3===e.nodeType},X=function(e,t,n){for(var r,o=e.childNodes,a=o[t],i=t,s=!1,d=!1;(V(r=a)&&8===r.nodeType||q(a)&&0===a.childNodes.length||q(a)&&"false"===a.getAttribute("contenteditable"))&&(!s||!d);)i>=o.length?(s=!0,i=t-1,n="backward"):i<0?(d=!0,i=t+1,n="forward"):(a=o[i],i+="forward"===n?1:-1);return a},Y=function(e){return o.isEditor(e)?e._state:e.children},G=function(e){return JSON.parse(JSON.stringify(e))},Q=function(e,t){if(r.isText(e))throw new Error("Cannot get the child of a text node: ".concat(JSON.stringify(e)));var n=Y(e)[t];if(null==n)throw new Error("Cannot get child at index `".concat(t,"` in node: ").concat(JSON.stringify(e)));return n},Z=function(e,t){for(var n=e,o=0;o<t.length;o++){var a=t[o],i=Y(n);if(r.isText(n)||!i[a])return!1;n=i[a]}return!0},ee=function(e,t){for(var n=e,o=0;o<t.length;o++){var a=t[o],i=Y(n);if(r.isText(n)||!i[a])throw new Error("Cannot find a descendant at path [".concat(t,"] in node: ").concat(JSON.stringify(e)));n=i[a]}return n},te=function(e,t){for(var n=t.slice(),o=a.get(e,n),i=Y(o);o&&!r.isText(o)&&0!==i.length;)o=i[0],n.push(0);return[o,n]},ne=function(e,t){for(var n=t.slice(),o=a.get(e,n),i=Y(o);o&&!r.isText(o)&&0!==i.length;){var s=i.length-1;o=i[s],n.push(s)}return[o,n]},re=function*(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.pass,o=t.reverse,s=void 0!==o&&o,d=t.from,l=void 0===d?[]:d,c=t.to,u=new Set,f=[],h=e;!c||!(s?i.isBefore(f,c):i.isAfter(f,c));)if(u.has(h)||(yield[h,f]),u.has(h)||r.isText(h)||0===Y(h).length||null!=n&&!1!==n([h,f])){if(0===f.length)break;if(!s){var p=i.next(f);if(a.has(e,p)){f=p,h=a.get(e,f);continue}}if(s&&0!==f[f.length-1]){var v=i.previous(f);f=v,h=a.get(e,f)}else f=i.parent(f),h=a.get(e,f),u.add(h)}else{u.add(h);var g=s?Y(h).length-1:0;i.isAncestor(f,l)&&(g=l[f.length]),f=f.concat(g),h=a.get(e,f)}},oe=(K=n.select,n.select=function(e,t){return t.__ob__&&(t=G(t)),K(e,t)},n),ae=function(){var e=a.get,t=a.nodes,n=a.has,r=a.first,o=a.child,i=a.last;return a.child=Q,a.has=Z,a.get=ee,a.first=te,a.last=ne,a.nodes=re,function(){a.get=e,a.nodes=t,a.has=n,a.first=r,a.child=o,a.last=i}},ie=function(e){return function(){var t=ae(),n=e.apply(void 0,arguments);return t(),n}},se=function(e){for(var t=ae(),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var a=e.apply(void 0,r);return t(),a},de={findKey:function(e,t){var n=w.get(t);return n||(n=new J,w.set(t,n)),n},findPath:function(e,t){for(var n=[],r=t;;){var a=h.get(r);if(null==a){if(o.isEditor(r))return n;break}var i=f.get(r);if(null==i)break;n.unshift(i),r=a}throw new Error("Unable to find the path for Slate node: ".concat(JSON.stringify(t)))},isFocused:function(e){return!!b.get(e)},isReadOnly:function(e){return!!y.get(e)},blur:function(e){var t=de.toDOMNode(e,e);b.set(e,!1),window.document.activeElement===t&&t.blur()},focus:function(e){var t=de.toDOMNode(e,e);b.set(e,!0),window.document.activeElement!==t&&t.focus({preventScroll:!0})},deselect:function(e){var t=e.selection,r=window.getSelection();r&&r.rangeCount>0&&r.removeAllRanges(),t&&n.deselect(e)},hasDOMNode:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.editable,a=void 0!==o&&o,i=de.toDOMNode(e,e);try{n=q(t)?t:t.parentElement}catch(e){if(!e.message.includes('Permission denied to access property "nodeType"'))throw e}return!!n&&(n.closest("[data-slate-editor]")===i&&(!a||n.isContentEditable||!!n.getAttribute("data-slate-zero-width")))},insertData:function(e,t){e.insertData(t)},setFragmentData:function(e,t){e.setFragmentData(t)},toDOMNode:function(e,t){var n=o.isEditor(t)?p.get(e):g.get(de.findKey(e,t));if(!n)throw new Error("Cannot resolve a DOM node from Slate node: ".concat(JSON.stringify(t)));return n},toDOMPoint:function(e,t){var n,r=W(o.node(e,t.path),1)[0],a=de.toDOMNode(e,r);o.void(e,{at:t})&&(t={path:t.path,offset:0});for(var i=0,s=0,d=Array.from(a.querySelectorAll("[data-slate-string], [data-slate-zero-width]"));s<d.length;s++){var l=d[s],c=l.childNodes[0];if(null!=c&&null!=c.textContent){var u=c.textContent.length,f=l.getAttribute("data-slate-length"),h=i+(null==f?u:parseInt(f,10));if(t.offset<=h){n=[c,Math.min(u,Math.max(0,t.offset-i))];break}i=h}}if(!n)throw new Error("Cannot resolve a DOM point from Slate point: ".concat(JSON.stringify(t)));return n},toDOMRange:function(e,t){var n=t.anchor,r=t.focus,o=s.isBackward(t),a=de.toDOMPoint(e,n),i=s.isCollapsed(t)?a:de.toDOMPoint(e,r),d=window.document.createRange(),l=W(o?i:a,2),c=l[0],u=l[1],f=W(o?a:i,2),h=f[0],p=f[1],v=!!(q(c)?c:c.parentElement).getAttribute("data-slate-zero-width"),g=!!(q(h)?h:h.parentElement).getAttribute("data-slate-zero-width");return d.setStart(c,v?1:u),d.setEnd(h,g?1:p),d},toSlateNode:function(e,t){var n=q(t)?t:t.parentElement;n&&!n.hasAttribute("data-slate-node")&&(n=n.closest("[data-slate-node]"));var r=n?v.get(n):null;if(!r)throw new Error("Cannot resolve a Slate node from DOM node: ".concat(n));return r},findEventRange:function(e,t){"nativeEvent"in t&&(t=t.nativeEvent);var n=t,r=n.clientX,a=n.clientY,i=n.target;if(null==r||null==a)throw new Error("Cannot resolve a Slate range from a DOM event: ".concat(t));var s,d=de.toSlateNode(e,t.target),l=de.findPath(e,d);if(o.isVoid(e,d)){var c=i.getBoundingClientRect(),u=e.isInline(d)?r-c.left<c.left+c.width-r:a-c.top<c.top+c.height-a,f=o.point(e,l,{edge:u?"start":"end"}),h=u?o.before(e,f):o.after(e,f);if(h)return o.range(e,h)}var p=window.document;if(p.caretRangeFromPoint)s=p.caretRangeFromPoint(r,a);else{var v=p.caretPositionFromPoint(r,a);v&&((s=p.createRange()).setStart(v.offsetNode,v.offset),s.setEnd(v.offsetNode,v.offset))}if(!s)throw new Error("Cannot resolve a Slate range from a DOM event: ".concat(t));return de.toSlateRange(e,s)},toSlatePoint:function(e,t){var n=function(e){var t=W(e,2),n=t[0],r=t[1];if(q(n)&&n.childNodes.length){var o=r===n.childNodes.length,a=o?"backward":"forward";for(n=X(n,o?r-1:r,a);q(n)&&n.childNodes.length;){var i=o?n.childNodes.length-1:0;n=X(n,i,a)}r=o&&null!=n.textContent?n.textContent.length:0}return[n,r]}(t),r=W(n,2),o=r[0],a=r[1],i=o.parentNode,s=null,d=0;if(i){var l=i.closest('[data-slate-void="true"]'),c=i.closest("[data-slate-leaf]"),u=null;if(c){s=c.closest('[data-slate-node="text"]');var f=window.document.createRange();f.setStart(s,0),f.setEnd(o,a);var h=f.cloneContents();[].concat(j(h.querySelectorAll("[data-slate-zero-width]")),j(h.querySelectorAll("[contenteditable=false]"))).forEach((function(e){e.parentNode.removeChild(e)})),d=h.textContent.length,u=s}else l&&(s=(c=l.querySelector("[data-slate-leaf]")).closest('[data-slate-node="text"]'),d=(u=c).textContent.length);u&&d===u.textContent.length&&i.hasAttribute("data-slate-zero-width")&&d--}if(!s)throw new Error("Cannot resolve a Slate point from DOM point: ".concat(t));var p=de.toSlateNode(e,s);return{path:de.findPath(e,p),offset:d}},toSlateRange:function(e,t){var n,r,o,a,i;if((t instanceof Selection?t.anchorNode:t.startContainer)&&(t instanceof Selection?(n=t.anchorNode,r=t.anchorOffset,o=t.focusNode,a=t.focusOffset,i=t.isCollapsed):(n=t.startContainer,r=t.startOffset,o=t.endContainer,a=t.endOffset,i=t.collapsed)),null==n||null==o||null==r||null==a)throw new Error("Cannot resolve a Slate range from DOM range: ".concat(t));var s=de.toSlatePoint(e,[n,r]);return{anchor:s,focus:i?s:de.toSlatePoint(e,[o,a])}}};de.toDOMRange=ie(de.toDOMRange);var le=function(e){var d=e,l=d.apply,c=d.onChange;return d.apply=function(n){var s=[];switch(d._operation=n,n.type){case"insert_text":case"remove_text":case"set_node":var c,u=z(o.levels(d,{at:n.path}));try{for(u.s();!(c=u.n()).done;){var f=W(c.value,2),h=f[0],p=f[1],v=de.findKey(d,h);s.push([p,v])}}catch(e){u.e(e)}finally{u.f()}break;case"insert_node":case"remove_node":case"merge_node":case"split_node":var g,m=z(o.levels(d,{at:i.parent(n.path)}));try{for(m.s();!(g=m.n()).done;){var y=W(g.value,2),b=y[0],S=y[1],k=de.findKey(d,b);s.push([S,k])}}catch(e){m.e(e)}finally{m.f()}}l(n);for(var x=0,C=s;x<C.length;x++){var D=W(C[x],2),O=D[0],E=D[1],F=W(o.node(d,O),1)[0];w.set(F,E)}se((function(){!function(e,n){switch(n.type){case"insert_node":var o=n.path,s=n.node,d=a.parent(e,o),l=o[o.length-1];Y(d).splice(l,0,G(s));break;case"insert_text":var c=n.path,u=n.offset,f=n.text,h=a.leaf(e,c),p=h.text.slice(0,u),v=h.text.slice(u);h.text=p+f+v;break;case"merge_node":var g=n.path,m=a.get(e,g),y=i.previous(g),b=a.get(e,y),S=a.parent(e,g),k=g[g.length-1];if(r.isText(m)&&r.isText(b))b.text+=m.text;else{if(r.isText(m)||r.isText(b))throw new Error('Cannot apply a "merge_node" operation at path ['.concat(g,"] to nodes of different interaces: ").concat(m," ").concat(b));var x;(x=Y(b)).push.apply(x,j(Y(m)))}Y(S).splice(k,1);break;case"move_node":var C=n.path,D=n.newPath;if(i.isAncestor(C,D))throw new Error("Cannot move a path [".concat(C,"] to new path [").concat(D,"] because the destination is inside itself."));var O=a.get(e,C),E=a.parent(e,C),F=C[C.length-1];Y(E).splice(F,1);var _=i.transform(C,n),B=a.get(e,i.parent(_)),N=_[_.length-1];Y(B).splice(N,0,O);break;case"remove_node":var $=n.path;w.delete(a.get(e,$));var M=$[$.length-1],L=a.parent(e,$);Y(L).splice(M,1);break;case"remove_text":var A=n.path,T=n.offset,W=n.text,R=a.leaf(e,A),I=R.text.slice(0,T),z=R.text.slice(T+W.length);R.text=I+z;break;case"set_node":var K=n.path,U=n.newProperties;if(0===K.length)throw new Error("Cannot set properties on the root node!");var J=a.get(e,K);for(var q in U){if("children"===q||"text"===q)throw new Error('Cannot set the "'.concat(q,'" property of nodes!'));var V=U[q];null==V?t.delete(J,q):t.set(J,q,V)}break;case"set_selection":break;case"split_node":var H=n.path,X=n.position,Q=n.properties;if(0===H.length)throw new Error('Cannot apply a "split_node" operation at path ['.concat(H,"] because the root node cannot be split."));var Z,ee=a.get(e,H),te=a.parent(e,H),ne=H[H.length-1];if(r.isText(ee)){var re=ee.text.slice(0,X),oe=ee.text.slice(X);ee.text=re,Z=P(P(P({},ee),Q),{},{text:oe})}else{var ae=ee.children.slice(0,X),ie=ee.children.slice(X);ee.children=ae,Z=P(P(P({},ee),Q),{},{children:ie})}Y(te).splice(ne+1,0,Z)}}(e,n)}))},d.setFragmentData=function(e){var t=d.selection;if(t){var n=W(s.edges(t),2),r=n[0],a=n[1],i=o.void(d,{at:r.path}),l=o.void(d,{at:a.path});if(!s.isCollapsed(t)||i){var c=de.toDOMRange(d,t),u=c.cloneContents(),f=u.childNodes[0];if(u.childNodes.forEach((function(e){e.textContent&&""!==e.textContent.trim()&&(f=e)})),l){var h=W(l,1)[0],p=c.cloneRange(),v=de.toDOMNode(d,h);p.setEndAfter(v),u=p.cloneContents()}if(i&&(f=u.querySelector("[data-slate-spacer]")),Array.from(u.querySelectorAll("[data-slate-zero-width]")).forEach((function(e){var t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?"\n":""})),H(f)){var g=document.createElement("span");g.style.whiteSpace="pre",g.appendChild(f),u.appendChild(g),f=g}var m=d.getFragment(),w=JSON.stringify(m),y=window.btoa(encodeURIComponent(w));f.setAttribute("data-slate-fragment",y),e.setData("application/x-slate-fragment",y);var b=document.createElement("div");b.appendChild(u),b.setAttribute("hidden","true"),document.body.appendChild(b),e.setData("text/html",b.innerHTML),e.setData("text/plain",function e(t){var n="";if(H(t)&&t.nodeValue)return t.nodeValue;if(q(t)){for(var r=0,o=Array.from(t.childNodes);r<o.length;r++)n+=e(o[r]);var a=getComputedStyle(t).getPropertyValue("display");"block"!==a&&"list"!==a&&"BR"!==t.tagName||(n+="\n")}return n}(b)),document.body.removeChild(b)}}},d.insertData=function(e){var t=e.getData("application/x-slate-fragment");if(t){var r=decodeURIComponent(window.atob(t)),o=JSON.parse(r);d.insertFragment(o)}else{var a=e.getData("text/plain");if(a){var i,s=!1,l=z(a.split(/\r\n|\r|\n/));try{for(l.s();!(i=l.n()).done;){var c=i.value;s&&n.splitNodes(d,{always:!0}),n.insertText(d,c),s=!0}}catch(e){l.e(e)}finally{l.f()}}}},d.onChange=function(){var e=S.get(d);e&&e(),c()},d},ce=function(e){return C.get(e)},ue=function(e,t){var n=e._watcher.update;e._watcher.update=function(){var r=e.$editor._operation;if(r){if("remove_text"===r.type||"insert_text"===r.type||"set_selection"===r.type)return;if("remove_node"===r.type&&"element"===t)return}n.call(e._watcher)}},fe={mounted:function(){this.$editor._state.__ob__.dep.addSub(this._watcher)}},he={created:function(){var e=ce(this.$editor),t=this.element||this.node;e.selected.elements.push(t)},computed:{selected:function(){if(this.element){var e=ce(this.$editor),t=w.get(this.element);return!!t&&e.selected[t.id]}return!1}}},pe={computed:{readOnly:function(){return ce(this.$editor).readOnly}}},ve={computed:{focused:function(){return ce(this.$editor).focused}}},ge=function(){var e=le(d()),n=new t({data:{focused:!1,selected:{elements:[]},readOnly:!1},methods:{updateSelected:function(){var e=this,t=D.get(this),n=t.selection;n&&this.selected.elements.forEach((function(r){var a=w.get(r);if(a){var i=a.id,d=de.findPath(t,r),l=o.range(t,d),c=s.intersection(l,n);e.$set(e.selected,i,!!c)}}))}}});return C.set(e,n),D.set(n,e),e},me={install:function(e,t){e.mixin({beforeCreate:function(){this.$editor||(this.$options.components.Slate?(this.$editor=ge(),(null==t?void 0:t.editorCreated)&&t.editorCreated.call(this,this.$editor)):this.$editor=this.$parent&&this.$parent.$editor)}}),e.use(M)}},we=function(e,t,n){Object.defineProperty(e,t,{configurable:!0,get:function(){return n},set:function(e){console.warn("tried to set frozen property ".concat(t," with ").concat(e))}})},ye=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object.defineProperty(e,t,{configurable:!0,writable:!0,value:n})},be=e({abstract:!0,name:"Fragment",props:{name:{type:String,default:function(){return Math.floor(Date.now()*Math.random()).toString(16)}}},mounted:function(){var e=this.$el,t=e.parentNode,n=document.createComment("fragment#".concat(this.name,"#head")),r=document.createComment("fragment#".concat(this.name,"#tail"));t.insertBefore(n,e),t.insertBefore(r,e),e.appendChild=function(n){t.insertBefore(n,r),we(n,"parentNode",e)},e.insertBefore=function(n,r){t.insertBefore(n,r),we(n,"parentNode",e)},e.removeChild=function(e){t.removeChild(e),ye(e,"parentNode")},Array.from(e.childNodes).forEach((function(t){return e.appendChild(t)})),t.removeChild(e),we(e,"parentNode",t),we(e,"nextSibling",r.nextSibling),we(r,"parentNode",e);var o=t.insertBefore;t.insertBefore=function(r,a){o.call(t,r,a!==e?a:n)};var a=t.removeChild;t.removeChild=function(i){if(i===e){for(;n.nextSibling!==r;)e.removeChild(n.nextSibling);t.removeChild(n),t.removeChild(r),ye(e,"parentNode"),t.insertBefore=o,t.removeChild=a}else a.call(t,i)}},render:function(e){var t=this.$slots.default;return e("div",{key:this.name},t)}}),Se=e({name:"slate",props:{value:String},components:{fragment:be},data:function(){return{name:null}},created:function(){var e=this;this.renderSlate(),this.$editor.clear=function(){e.renderSlate(JSON.stringify([{children:[{text:""}]}]))}},watch:{value:function(e,t){e!==t&&this.renderSlate(e)}},methods:{genUid:function(){return Math.floor(Date.now()*Math.random()).toString(16)},renderSlate:function(e){var n=e||this.value,r=this.$editor;r.children=JSON.parse(n);var o=JSON.parse(n);r._state=t.observable(o),this.clearEditor(),this.name=this.genUid()},clearEditor:function(){this.$editor.selection=null}},render:function(){var e=this,t=arguments[0];return S.set(this.$editor,(function(){e.$editor._state.__ob__.dep.notify();var t=ce(e.$editor);t.focused=de.isFocused(e.$editor);var n=e.$editor._operation;n&&"set_selection"===n.type&&t.updateSelected(),e.$emit("onChange")})),t(be,{attrs:{name:this.name}},[this.$scopedSlots.default()])}}),ke=e({props:{text:String,isTrailing:Boolean},render:function(){var e=arguments[0],t=this.text,n=this.isTrailing,r=void 0!==n&&n;return e("span",{attrs:{"data-slate-string":!0}},[t,r?"\n":null])}}),xe={functional:!0,render:function(e,t){var n=t.props,r=n.length,o=void 0===r?0:r,a=n.isLineBreak,i=void 0!==a&&a;return e("span",{attrs:{"data-slate-zero-width":i?"n":"z","data-slate-length":o}},["\ufeff",i?e("br"):null])}},Ce=e({props:{leaf:Object,editor:Object},inject:["isLast","parent","text"],components:{TextString:ke},render:function(){var e=arguments[0],t=this.leaf,n=this.editor,r=this.isLast,s=this.parent,d=this.text,l=de.findPath(n,d),c=i.parent(l);return n.isVoid(s)?e(xe,{attrs:{length:a.string(s).length}}):""!==t.text||s.children[s.children.length-1]!==d||n.isInline(s)||""!==o.string(n,c)?""===t.text?e(xe):r&&"\n"===t.text.slice(-1)?e(ke,{attrs:{isTrailing:!0,text:t.text}}):e(ke,{attrs:{text:t.text}}):e(xe,{attrs:{isLineBreak:!0}})}}),De=e({props:{text:Object,leaf:Object},inject:["renderLeaf"],components:{string:Ce,fragment:be},render:function(e){var t=this.renderLeaf,n=void 0===t?Oe:t,r=this.text,o=this.leaf,a=e(Ce,{attrs:{text:r,editor:this.$editor,leaf:o}});o[k]&&(a=e(be,[e("span",{attrs:{contenteditable:!1},style:{pointerEvents:"none",display:"inline-block",verticalAlign:"text-top",width:"0",maxWidth:"100%",whiteSpace:"nowrap",opacity:"0.333"}},[o.placeholder]),a]));return e(n({children:a,attributes:{"data-slate-leaf":!0},leaf:o,text:r}))}}),Oe=function(t){return e({render:function(){var e=arguments[0],n=t.attributes,r=t.children;return e("span",{attrs:P({},n)},[r])}})},Ee=e({props:{text:Object,isLast:Boolean,parent:Object,decorations:Array},components:{leaf:De},inject:["decorate","placeholder"],provide:function(){return{text:this.text,isLast:this.isLast,parent:this.parent}},hooks:function(){var e=this.ref=$(null),t=this.text,n=this.$editor,r=de.findKey(n,t);N((function(){e.current?(g.set(r,e.current),m.set(t,e.current),v.set(e.current,t)):(g.delete(r),m.delete(t))}))},render:function(e,t){var n=this.text,i=this.placeholder,s=this.decorations;if(!s){var d=this.$editor,l=de.findPath(d,n);if(s=this.decorate([n,l]),i&&1===d.children.length&&1===Array.from(a.texts(d)).length&&""===a.string(d)){var c,u=o.start(d,[]);s.push((A(c={},k,!0),A(c,"placeholder",i),A(c,"anchor",u),A(c,"focus",u),c))}}for(var f=r.decorations(n,s),h=[],p=0;p<f.length;p++){var v=f[p];h.push(e(De,{attrs:{leaf:v}}))}return e("span",{attrs:{"data-slate-node":"text"},ref:this.ref.id},[h])}}),Fe=e({props:{element:Object},inject:["renderElement"],components:{Children:Be},mixins:[pe],mounted:function(){ue(this,"element")},hooks:function(){var e=this.ref=$(null),t=this.element,n=de.findKey(this.$editor,t);N((function(){e.current?(g.set(n,e.current),m.set(t,e.current),v.set(e.current,t)):(g.delete(n),m.delete(t))}))},render:function(e){var t=this.element,n=this.renderElement,r=void 0===n?_e:n,i=this.ref,s=this.$editor,d=s.isInline(t),l=e(Be,{attrs:{node:t}}),u={"data-slate-node":"element"};if(d&&(u["data-slate-inline"]=!0),!d&&o.hasInlines(s,t)){var p=a.string(t),v=c(p);"rtl"===v&&(u.dir=v)}if(o.isVoid(s,t)){u["data-slate-void"]=!0,!this.readOnly&&d&&(u.contentEditable=!1);var g=d?"span":"div",m=W(a.texts(t),1),w=W(m[0],1)[0];l=this.readOnly?null:e(g,{attrs:{"data-slate-spacer":!0},style:{height:"0",color:"transparent",outline:"none",position:"absolute"}},[e(Ee,{attrs:{decorations:[],isLast:!1,parent:t,text:w}})]),f.set(w,0),h.set(w,t)}return e(r({element:t,attributes:u,children:l}),{ref:i.id})}}),_e=function(t){return e({render:function(){var e=arguments[0],n=t.attributes,r=t.children,o=t.element,a=this.$editor,i=a.isInline(o)?"span":"div";return e(i,{attrs:P({},n),style:{position:"relative"}},[r])}})},Be=e({props:{node:Object},components:{TextComponent:Ee,ElementComponent:Fe,fragment:be},inject:["decorate"],mixins:[fe],mounted:function(){ue(this,"children")},render:function(){for(var e=arguments[0],t=this.$editor,n=this.node,r=de.findPath(t,n),a=l.isElement(n)&&!t.isInline(n)&&o.hasInlines(t,n),s=[],d=o.isEditor(n)?n._state:n.children,c=null,u=0;u<d.length;u++){var p=d[u],v=de.findKey(t,p),g=r.concat(u);o.range(t,g);if(f.set(p,u),h.set(p,n),t._operation&&x.get(v)){var m=t._operation.path;if("split_node"===t._operation.type&&i.isSibling(g,m)&&!i.equals(g,m)&&!i.equals(g,i.next(m))){c=x.get(v),s.push(c);continue}if("merge_node"===t._operation.type){var w=i.parent(m);if(i.isSibling(g,w)&&!i.isParent(g,m)){c=x.get(v),s.push(c);continue}}if("remove_node"===t._operation.type&&i.isSibling(g,m)&&!i.equals(g,m)){c=x.get(v),s.push(c);continue}}l.isElement(p)?(c=e(Fe,{attrs:{element:p},key:v.id}),s.push(c)):(c=e(Ee,{attrs:{isLast:a&&u===d.length-1,parent:n,text:p},key:v.id}),s.push(c)),x.set(v,c)}return e(be,[s])}}),Ne=("undefined"!=typeof navigator&&"undefined"!=typeof window&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream,"undefined"!=typeof navigator&&/Mac OS X/.test(navigator.userAgent)),$e="undefined"!=typeof navigator&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Me="undefined"!=typeof navigator&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),Le="undefined"!=typeof navigator&&/Edge?\/(?:[0-6][0-9]|[0-7][0-8])/i.test(navigator.userAgent),Ae={bold:"mod+b",compose:["down","left","right","up","backspace","enter"],moveBackward:"left",moveForward:"right",moveWordBackward:"ctrl+left",moveWordForward:"ctrl+right",deleteBackward:"shift?+backspace",deleteForward:"shift?+delete",extendBackward:"shift+left",extendForward:"shift+right",italic:"mod+i",splitBlock:"shift?+enter",undo:"mod+z"},Te={moveLineBackward:"opt+up",moveLineForward:"opt+down",moveWordBackward:"opt+left",moveWordForward:"opt+right",deleteBackward:["ctrl+backspace","ctrl+h"],deleteForward:["ctrl+delete","ctrl+d"],deleteLineBackward:"cmd+shift?+backspace",deleteLineForward:["cmd+shift?+delete","ctrl+k"],deleteWordBackward:"opt+shift?+backspace",deleteWordForward:"opt+shift?+delete",extendLineBackward:"opt+shift+up",extendLineForward:"opt+shift+down",redo:"cmd+shift+z",transposeCharacter:"ctrl+t"},Pe={deleteWordBackward:"ctrl+shift?+backspace",deleteWordForward:"ctrl+shift?+delete",redo:["ctrl+y","ctrl+shift+z"]},We=function(e){var t=Ae[e],n=Te[e],r=Pe[e],o=t&&u(t),a=n&&u(n),i=r&&u(r);return function(e){return!(!o||!o(e))||(!!(Ne&&a&&a(e))||!(Ne||!i||!i(e)))}},je={isBold:We("bold"),isCompose:We("compose"),isMoveBackward:We("moveBackward"),isMoveForward:We("moveForward"),isDeleteBackward:We("deleteBackward"),isDeleteForward:We("deleteForward"),isDeleteLineBackward:We("deleteLineBackward"),isDeleteLineForward:We("deleteLineForward"),isDeleteWordBackward:We("deleteWordBackward"),isDeleteWordForward:We("deleteWordForward"),isExtendBackward:We("extendBackward"),isExtendForward:We("extendForward"),isExtendLineBackward:We("extendLineBackward"),isExtendLineForward:We("extendLineForward"),isItalic:We("italic"),isMoveLineBackward:We("moveLineBackward"),isMoveLineForward:We("moveLineForward"),isMoveWordBackward:We("moveWordBackward"),isMoveWordForward:We("moveWordForward"),isRedo:We("redo"),isSplitBlock:We("splitBlock"),isTransposeCharacter:We("transposeCharacter"),isUndo:We("undo")},Re="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Ie=String.fromCharCode(32),ze=!1;var Ke=function(e,t){var n=!1;switch(e){case"compositionend":return function(e){var t=e.detail;return"object"===L(t)&&"data"in t?t.data:null}(t);case"keypress":return 32!==t.which?null:(n=!0,Ie);case"textInput":var r=t.data;return r===Ie&&n?null:r;default:return null}};var Ue=function(e,t){var n;n=Re&&"TextEvent"in window?Ke(e,t):function(e,t){if(ze)return"compositionend"===e?t.data:null;switch(e){case"paste":return null;case"keypress":if(!function(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}(t)){if(t.char&&t.char.length>1)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return t.data;default:return null}}(e,t);var r=new CustomEvent("beforeinput",{detail:n});t.target&&t.target.dispatchEvent(r)},Je=!($e||Le),qe=function(e,t){var n=Xe(e,t)&&de.toSlateNode(e,t);return o.isVoid(e,n)},Ve=function(e,t){return!!t&&(t(e),e.defaultPrevented||e.cancelBubble)},He=function(e,t){return V(t)&&de.hasDOMNode(e,t,{editable:!0})},Xe=function(e,t){return V(t)&&de.hasDOMNode(e,t)},Ye=e({props:{autoFocus:Boolean,renderLeaf:Function,renderElement:Function,readOnly:Boolean,decorate:{type:Function,default:function(){return[]}},placeholder:String,spellCheck:Boolean,autoCorrect:String,autoCapitalize:String,onBeforeInput:Function,onKeyDown:Function,onClick:Function,onCompositionEnd:Function,onCompositionStart:Function,onCut:Function,onCopy:Function,onDragOver:Function,onDragStart:Function,onDragStop:Function,onPaste:Function,onFocus:Function,onBlur:Function},components:{Children:Be},mixins:[fe],provide:function(){return{renderLeaf:this.renderLeaf,renderElement:this.renderElement,decorate:this.decorate,readOnly:this.readOnly,placeholder:this.placeholder}},data:function(){return{latestElement:null,isComposing:!1,isUpdatingSelection:!1}},methods:{_onClick:function(e){var t=this.$editor;if(!this.readOnly&&Xe(t,e.target)&&V(e.target)&&!Ve(e,this.onClick)){var r=de.toSlateNode(t,e.target),a=de.findPath(t,r),i=o.start(t,a);if(o.void(t,{at:i})){var s=o.range(t,i);n.select(t,s)}}},onSelectionchange:function(){var e=this.readOnly,t=this.$editor;if(!e&&!this.isComposing&&!this.isUpdatingSelection){var r=window.document.activeElement,o=de.toDOMNode(t,t),a=window.getSelection();if(r===o?(this.latestElement=r,b.set(t,!0)):b.delete(t),!a)return n.deselect(t);var i=a.anchorNode,s=a.focusNode,d=He(t,i)||qe(t,i),l=He(t,s)||qe(t,s);if(d&&l){var c=de.toSlateRange(t,a);n.select(t,c)}else n.deselect(t)}},_onBeforeInput:function(e){var t=this.$editor;if($e){e.preventDefault(),e.stopPropagation();var r=e.detail;o.insertText(t,r)}else if(!this.readOnly&&He(t,e.target)&&!Ve(e,this.onBeforeInput)){var a=t.selection,i=e.inputType,d=e.dataTransfer||e.data||void 0;if("insertCompositionText"===i||"deleteCompositionText"===i)return;if(e.preventDefault(),!i.startsWith("delete")||i.startsWith("deleteBy")){var l=W(e.getTargetRanges(),1)[0];if(l){var c=de.toSlateRange(t,l);a&&s.equals(a,c)||n.select(t,c)}}if(a&&s.isExpanded(a)&&i.startsWith("delete"))return void o.deleteFragment(t);switch(i){case"deleteByComposition":case"deleteByCut":case"deleteByDrag":o.deleteFragment(t);break;case"deleteContent":case"deleteContentForward":o.deleteForward(t);break;case"deleteContentBackward":o.deleteBackward(t);break;case"deleteEntireSoftLine":o.deleteBackward(t,{unit:"line"}),o.deleteForward(t,{unit:"line"});break;case"deleteHardLineBackward":o.deleteBackward(t,{unit:"block"});break;case"deleteSoftLineBackward":o.deleteBackward(t,{unit:"line"});break;case"deleteHardLineForward":o.deleteForward(t,{unit:"block"});break;case"deleteSoftLineForward":o.deleteForward(t,{unit:"line"});break;case"deleteWordBackward":o.deleteBackward(t,{unit:"word"});break;case"deleteWordForward":o.deleteForward(t,{unit:"word"});break;case"insertLineBreak":case"insertParagraph":o.insertBreak(t);break;case"insertFromComposition":case"insertFromDrop":case"insertFromPaste":case"insertFromYank":case"insertReplacementText":case"insertText":d instanceof DataTransfer?de.insertData(t,d):"string"==typeof d&&o.insertText(t,d)}}},_onCompositionEnd:function(e){var t=this.$editor;He(t,e.target)&&!Ve(e,this.onCompositionEnd)&&(this.isComposing=!1,Me||$e||!e.data||o.insertText(t,e.data))},_onCompositionStart:function(e){var t=this.$editor;He(t,e.target)&&!Ve(e,this.onCompositionStart)&&(this.isComposing=!0)},_onKeyDown:function(e){var t=this.$editor;if(!this.readOnly&&He(t,e.target)&&!Ve(e,this.onKeyDown)){var r=e,a=t.selection;if(je.isRedo(r))return e.preventDefault(),void(t.redo&&t.redo());if(je.isUndo(r))return e.preventDefault(),void(t.undo&&t.undo());if(je.isMoveLineBackward(r))return e.preventDefault(),void n.move(t,{unit:"line",reverse:!0});if(je.isMoveLineForward(r))return e.preventDefault(),void n.move(t,{unit:"line"});if(je.isExtendLineBackward(r))return e.preventDefault(),void n.move(t,{unit:"line",edge:"focus",reverse:!0});if(je.isExtendLineForward(r))return e.preventDefault(),void n.move(t,{unit:"line",edge:"focus"});if(je.isMoveBackward(r))return e.preventDefault(),void(a&&s.isCollapsed(a)?n.move(t,{reverse:!0}):n.collapse(t,{edge:"start"}));if(je.isMoveForward(r))return e.preventDefault(),void(a&&s.isCollapsed(a)?n.move(t):n.collapse(t,{edge:"end"}));if(je.isMoveWordBackward(r))return e.preventDefault(),void n.move(t,{unit:"word",reverse:!0});if(je.isMoveWordForward(r))return e.preventDefault(),void n.move(t,{unit:"word"});if(!Je){if(je.isBold(r)||je.isItalic(r)||je.isTransposeCharacter(r))return void e.preventDefault();if(je.isSplitBlock(r))return e.preventDefault(),void o.insertBreak(t);if(je.isDeleteBackward(r))return e.preventDefault(),void(a&&s.isExpanded(a)?o.deleteFragment(t):o.deleteBackward(t));if(je.isDeleteForward(r))return e.preventDefault(),void(a&&s.isExpanded(a)?o.deleteFragment(t):o.deleteForward(t));if(je.isDeleteLineBackward(r))return e.preventDefault(),void(a&&s.isExpanded(a)?o.deleteFragment(t):o.deleteBackward(t,{unit:"line"}));if(je.isDeleteLineForward(r))return e.preventDefault(),void(a&&s.isExpanded(a)?o.deleteFragment(t):o.deleteForward(t,{unit:"line"}));if(je.isDeleteWordBackward(r))return e.preventDefault(),void(a&&s.isExpanded(a)?o.deleteFragment(t):o.deleteBackward(t,{unit:"word"}));if(je.isDeleteWordForward(r))return e.preventDefault(),void(a&&s.isExpanded(a)?o.deleteFragment(t):o.deleteForward(t,{unit:"word"}))}}},_onFocus:function(e){var t=this.$editor;if(!this.readOnly&&!this.isUpdatingSelection&&He(t,e.target)&&!Ve(e,this.onFocus)){var n=de.toDOMNode(t,t);if(this.latestElement=window.document.activeElement,$e&&e.target!==n)return void n.focus();b.set(t,!0)}},_onBlur:function(e){var t=this.$editor;if(!this.readOnly&&!this.isUpdatingSelection&&He(t,e.target)&&Ve(e,this.onBlur)&&this.latestElement!==window.document.activeElement){var n=e.relatedTarget;if(!(n===de.toDOMNode(t,t)||q(n)&&n.hasAttribute("data-slate-spacer"))){if(null!=n&&V(n)&&de.hasDOMNode(t,n)){var r=de.toSlateNode(t,n);if(l.isElement(r)&&!t.isVoid(r))return}b.delete(t)}}},_onCopy:function(e){var t=this.$editor;He(t,e.target)&&!Ve(e,this.onCopy)&&(e.preventDefault(),de.setFragmentData(t,e.clipboardData))},_onPaste:function(e){var t=this.$editor,n=this.readOnly;Je&&!function(e){return e.clipboardData&&""!==e.clipboardData.getData("text/plain")&&1===e.clipboardData.types.length}(e)||n||!He(t,e.target)||Ve(e,this.onPaste)||(e.preventDefault(),de.insertData(t,e.clipboardData))},_onCut:function(e){var t=this.$editor;if(!this.readOnly&&He(t,e.target)&&!Ve(e,this.onCut)){e.preventDefault(),de.setFragmentData(t,e.clipboardData);var n=t.selection;n&&s.isExpanded(n)&&o.deleteFragment(t)}},_onDragOver:function(e){var t=this.$editor;if(Xe(t,e.target)&&!Ve(e,this.onDragOver)){var n=de.toSlateNode(t,e.target);o.isVoid(t,n)&&e.preventDefault()}},_onDragStart:function(e){var t=this.$editor;if(Xe(t,e.target)&&!Ve(e,this.onDragStart)){var r=de.toSlateNode(t,e.target),a=de.findPath(t,r);if(o.void(t,{at:a})){var i=o.range(t,a);n.select(t,i)}de.setFragmentData(t,e.clipboardData)}},_onDrop:function(e){var t=this.$editor;if(Xe(t,e.target)&&!this.readOnly&&!Ve(e,this.onDrop)&&(!Je||!Me&&e.dataTransfer.files.length>0)){e.preventDefault();var r=de.findEventRange(t,e),o=e.dataTransfer;n.select(t,r),de.insertData(t,o)}}},hooks:function(){var e=this,t=this.ref=$(null),n=this.$editor;y.set(n,this.readOnly);N((function(){return document.addEventListener("selectionchange",e.onSelectionchange),function(){document.removeEventListener("selectionchange",e.onSelectionchange)}})),N((function(){t.current?(p.set(n,t.current),m.set(n,t.current),v.set(t.current,n)):m.delete(n)})),N((function(){var t=n.selection,r=window.getSelection();if(!e.isComposing&&r&&de.isFocused(n)){var o="None"!==r.type;if(t||o){var a=p.get(n),i=!1;if(a.contains(r.anchorNode)&&a.contains(r.focusNode)&&(i=!0),!(o&&i&&t&&s.equals(de.toSlateRange(n,r),t))){var d=de.toDOMNode(n,n);e.isUpdatingSelection=!0;var l=t&&de.toDOMRange(n,t);l?(s.isBackward(t)?r.setBaseAndExtent(l.endContainer,l.endOffset,l.startContainer,l.startOffset):r.setBaseAndExtent(l.startContainer,l.startOffset,l.endContainer,l.endOffset),l.startContainer.parentElement):r.removeAllRanges(),setTimeout((function(){l&&$e&&d.focus(),e.isUpdatingSelection=!1}))}}}})),N((function(){t.current&&e.autoFocus&&setTimeout((function(){t.current.focus()}),0)}),[e.autoFocus]),$e&&N((function(){var e,n;e=t.current,n=!0,["compositionend","textInput","keypress"].forEach((function(t){e.addEventListener(t,(function(e){Ue(t,e),"compositionend"===t&&(ze=!1),n&&e.preventDefault()}))})),e.addEventListener("compositionstart",(function(){return ze=!0}))}),[])},render:function(){var e=arguments[0],t=this.$editor,n=this.ref,r={click:this._onClick,keydown:this._onKeyDown,focus:this._onFocus,blur:this._onBlur,beforeinput:this._onBeforeInput,copy:this._onCopy,cut:this._onCut,compositionend:this._onCompositionEnd,compositionstart:this._onCompositionStart,dragover:this._onDragOver,dragstart:this._onDragStart,drop:this._onDrop,paste:this._onPaste},o={spellcheck:Je?this.spellCheck:void 0,autocorrect:Je?this.autoCorrect:void 0,autocapitalize:Je?this.autoCapitalize:void 0};return e("div",{attrs:P({"data-gramm":!1,role:this.readOnly?void 0:"textbox",contenteditable:!this.readOnly,"data-slate-editor":!0,"data-slate-node":"value"},o),ref:n.id,style:{outline:"none",whiteSpace:"pre-wrap",wordWrap:"break-word"},on:P({},r)},[e(Be,{attrs:{node:t,selection:t.selection}})])}});export{Ye as Editable,ve as FocusedMixin,pe as ReadOnlyMixin,he as SelectedMixin,Se as Slate,fe as SlateMixin,me as SlatePlugin,oe as Transforms,de as VueEditor,ue as elementWatcherPlugin,be as fragment,ce as getGvm,N as useEffect,$ as useRef,se as vueRuntime,ie as vueRuntimeFunc};
//# sourceMappingURL=index.es.js.map
